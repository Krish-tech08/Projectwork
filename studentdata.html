<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Students - Student Management System</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <!-- ===== NAVIGATION BAR ===== -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="access.html" class="navbar-brand">Student Management</a>
            <ul class="navbar-menu">
                <li><a href="form.html">Add Student</a></li>
                <li><a href="studentdata.html" class="active">View Students</a></li>
                <li><a href="access.html">Logout</a></li>
            </ul>
        </div>
    </nav>

    <!-- ===== MAIN CONTAINER ===== -->
    <div class="container">

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Student Records</h1>
            <a href="form.html" class="btn btn-primary">+ Add New Student</a>
        </div>

        <!-- Stats Section -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="totalStat">0</div>
                <div class="stat-label">Total Students</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="courseStat">0</div>
                <div class="stat-label">Active Courses</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="enrollmentStat">100%</div>
                <div class="stat-label">Enrollment Rate</div>
            </div>
        </div>

        <!-- Search Bar + Table Card -->
        <div class="card">

            <!-- Search Bar -->
            <div class="search-bar">
                <input 
                    type="text"
                    id="searchInput"
                    class="search-control"
                    placeholder="ðŸ” Search by name, roll number, or course..."
                    onkeyup="handleSearch()"
                >
            </div>

            <!-- Student Table -->
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Roll No</th>
                            <th>Course</th>
                            <th>Email</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Dynamic Data Will Load Here -->
                    </tbody>
                </table>
            </div>

            <!-- Total Count -->
            <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid var(--border-color);">
                <p style="color: var(--text-secondary); font-weight: 600;">
                    Showing 
                    <span id="totalStudents" style="color: var(--primary-color);">0</span> 
                    students
                </p>
            </div>

        </div>
    </div>

<script>

    function getStudents() {
        return JSON.parse(localStorage.getItem("students")) || [];
    }

    function saveStudents(students) {
        localStorage.setItem("students", JSON.stringify(students));
    }

    function renderTable(data) {

        const tableBody = document.getElementById("tableBody");
        tableBody.innerHTML = "";

        // Update total count
        document.getElementById("totalStudents").innerText = data.length;
        document.getElementById("totalStat").innerText = data.length;

        // Calculate unique courses
        const uniqueCourses = [...new Set(data.map(s => s.course))];
        document.getElementById("courseStat").innerText = uniqueCourses.length;

        if (data.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align:center; color:red;">
                        No students found
                    </td>
                </tr>
            `;
            return;
        }

        data.forEach((student, index) => {

            const row = `
                <tr>
                    <td>${student.name}</td>
                    <td>${student.roll}</td>
                    <td>${student.course}</td>
                    <td>${student.email}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-success"
                                onclick="handleEdit(${index})">
                                Edit
                            </button>
                            <button class="btn btn-small btn-danger"
                                onclick="handleDelete(${index})">
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;

            tableBody.innerHTML += row;
        });
    }

    function handleDelete(index) {

        if (!confirm("Are you sure you want to delete this student?")) return;

        const students = getStudents();
        students.splice(index, 1);
        saveStudents(students);
        renderTable(students);
    }

    function handleEdit(index) {
        window.location.href = `form.html?index=${index}`;
    }

    function handleSearch() {

        const searchValue = document.getElementById("searchInput")
                                .value.toLowerCase();

        const students = getStudents();

        const filtered = students.filter(student =>
            student.name.toLowerCase().includes(searchValue) ||
            student.roll.toLowerCase().includes(searchValue) ||
            student.course.toLowerCase().includes(searchValue)
        );

        renderTable(filtered);
    }

    window.onload = function() {
        renderTable(getStudents());
    };

</script>

</body>
</html>
